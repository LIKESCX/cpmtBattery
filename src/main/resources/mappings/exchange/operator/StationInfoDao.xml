<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cpit.cpmt.biz.dao.exchange.operator.StationInfoDAO">
  <resultMap id="BaseResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow">
    <id column="sid" jdbcType="VARCHAR" property="sid" />
    <result column="station_id" jdbcType="VARCHAR" property="stationID" />
    <result column="operator_id" jdbcType="VARCHAR" property="operatorID" />
    <result column="station_name" jdbcType="VARCHAR" property="stationName" />
    <result column="equipment_owner_id" jdbcType="VARCHAR" property="equipmentOwnerID" />
    <result column="country_code" jdbcType="VARCHAR" property="countryCode" />
    <result column="area_code" jdbcType="VARCHAR" property="areaCode" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="station_tel" jdbcType="VARCHAR" property="stationTel" />
    <result column="service_tel" jdbcType="VARCHAR" property="serviceTel" />
    <result column="station_type" jdbcType="INTEGER" property="stationType" />
    <result column="station_status" jdbcType="INTEGER" property="stationStatus" />
    <result column="park_nums" jdbcType="INTEGER" property="parkNums" />
    <result column="station_lng" jdbcType="DOUBLE" property="stationLng" />
    <result column="station_lat" jdbcType="DOUBLE" property="stationLat" />
    <result column="site_guide" jdbcType="VARCHAR" property="siteGuide" />
    <result column="construction" jdbcType="INTEGER" property="construction" />
    <result column="match_cars" jdbcType="VARCHAR" property="matchCars" />
    <result column="park_info" jdbcType="VARCHAR" property="parkInfo" />
    <result column="busine_hours" jdbcType="VARCHAR" property="busineHours" />
    <result column="electricity_fee" jdbcType="VARCHAR" property="electricityFee" />
    <result column="service_fee" jdbcType="VARCHAR" property="serviceFee" />
    <result column="park_fee" jdbcType="VARCHAR" property="parkFee" />
    <result column="payment" jdbcType="VARCHAR" property="payment" />
    <result column="support_order" jdbcType="INTEGER" property="supportOrder" />
    <result column="park_owner" jdbcType="VARCHAR" property="parkOwner" />
    <result column="park_manager" jdbcType="VARCHAR" property="parkManager" />
    <result column="open_all_day" jdbcType="INTEGER" property="openAllDay" />
    <result column="park_free" jdbcType="INTEGER" property="parkFree" />
    <result column="operate_property" jdbcType="INTEGER" property="opratorType" />
    <result column="build_date" jdbcType="TIMESTAMP" property="buildDate" />
    <result column="allowance_date" jdbcType="TIMESTAMP" property="allowanceDate" />
    <result column="connection_time" jdbcType="TIMESTAMP" property="connectionTime" />
    <result column="station_principal" jdbcType="VARCHAR" property="stationPrincipal" />
    <result column="property_unit" jdbcType="VARCHAR" property="propertyUnit" />
    <result column="invest_build_unit" jdbcType="VARCHAR" property="investBuildUnit" />
    <result column="station_land_kind" jdbcType="VARCHAR" property="stationLandKind" />
    <result column="land_use_time" jdbcType="VARCHAR" property="landUseTime" />
    <result column="land_remain_time" jdbcType="VARCHAR" property="landRemainTime" />
    <result column="station_kind" jdbcType="VARCHAR" property="stationKind" />
    <result column="charge_sum" jdbcType="INTEGER" property="chargeSum" />
    <result column="gun_sum" jdbcType="INTEGER" property="gunSum" />
    <result column="allowance_status" jdbcType="INTEGER" property="allowanceStatus" />
    <result column="allowance_price" jdbcType="VARCHAR" property="allowancePrice" />
    <result column="checkout_status" jdbcType="INTEGER" property="checkoutStatus" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="rent_date" jdbcType="VARCHAR" property="rentDate" />
    <result column="invent_extend" jdbcType="VARCHAR" property="inventExtend" />
    <result column="station_street" jdbcType="VARCHAR" property="stationStreet" />
    <result column="station_property" jdbcType="INTEGER" property="stationProperty" />
    <result column="service_car_type" jdbcType="VARCHAR" property="serviceCarType" />
    <result column="land_property" jdbcType="INTEGER" property="landProperty" />
    <result column="operator_property" jdbcType="VARCHAR" property="operatorProperty" />
    <result column="power_sum" jdbcType="DOUBLE" property="powerSum" />
    <result column="charge_electic_sum" jdbcType="VARCHAR" property="chargeElecticSum" />
    <result column="dis_charge_eletics_sum" jdbcType="VARCHAR" property="disChargeEleticsSum" />
    <result column="charge_num" jdbcType="INTEGER" property="chargTimes" />
    <result column="charge_error_num" jdbcType="INTEGER" property="chargeErrorTimes" />
    <result column="hours" jdbcType="INTEGER" property="hours" />
    <result column="sunday" jdbcType="VARCHAR" property="sunday" />
    <result column="saturday" jdbcType="VARCHAR" property="saturday" />
    <association property="area"  column="area_code" select="com.cpit.cpmt.biz.dao.system.AreaDao.getAreaByCode"/>
    <association property="areaStreet"  column="station_street" select="com.cpit.cpmt.biz.dao.system.AreaStreetDao.getStreetById"/>
  </resultMap>
  <resultMap id="mixedOperatResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="BaseResultMap">
    <association property="operatorInfo"  column="operator_id" select="com.cpit.cpmt.biz.dao.exchange.operator.OperatorInfoDao.selectByPrimaryKey"/>
    <association property="operateType"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.selectEquipmentListSize"/>
  </resultMap>

  <!--设备列表-->
  <resultMap id="mixedEquipmentResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="mixedOperatResultMap">
    <collection property="equipmentShowInfos"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.selectEquipmentList"/>
  </resultMap>

  <!--地图单个场站，站点图片，设施列表及充电量，次数-->
  <resultMap id="mixedMapStationResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="mixedOperatResultMap">
<!--
    <collection property="equipmentShowInfos"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.getChargeAndTimes"/>
-->
    <collection property="pictureList" select="com.cpit.cpmt.biz.dao.exchange.operator.ChargeFileDAO.getStationPictureList" column="{operatorId=operator_id,stationId=station_id}"/>
  </resultMap>

  <resultMap id="chargeMapStationMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="mixedOperatResultMap">
    <association property="freeNumber"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.getEquipmentWithIfFreeNumber"/>
    <association property="chargeSum"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.selectEquipmentListSize"/>
  </resultMap>

  <resultMap id="mixedStationResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="BaseResultMap">
    <association property="operatorInfo"  column="operator_id" select="com.cpit.cpmt.biz.dao.exchange.operator.OperatorInfoDao.selectByPrimaryKey"/>
    <association property="stationEvaluateResult"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.monitor.StationEvaluateResultDAO.selectByStationId"/>
  </resultMap>

  <resultMap id="allowanceMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="BaseResultMap">
    <association property="operatorInfo"  column="operator_id" select="com.cpit.cpmt.biz.dao.exchange.operator.OperatorInfoDao.selectByPrimaryKey"/>
    <association property="equipmentShowInfos" column="{operatorID=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.getEquipmentWithAllowance"/>
  </resultMap>

  <!--大屏地图单个充电站查询-->
  <resultMap id="largeScreenSingleStation" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="mixedOperatResultMap">
    <association property="chargingNumber"   column="{operatorId=operator_id,stationId=station_id}" select="com.cpit.cpmt.biz.dao.exchange.operator.EquipmentInfoDAO.getEquipmentWithChargingNumber"/>
  </resultMap>

  <!--动态信息-->
  <resultMap id="mixedDynamicResultMap" type="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" extends="BaseResultMap">
    <!--<association property="chargTimes" select="getAllChargeNum" column="{operatorID=operator_id,stationID=station_id}" />-->
    <association property="chargeErrorTimes" select="getAllChargeErrorNum" column="{operatorID=operator_id,stationID=station_id}"/>
  </resultMap>

  <!--充电量小时级信息-->
  <resultMap id="StationHourMap" type="com.cpit.cpmt.dto.analyze.preprocess.StationStatisticsHour" >
    <result column="operator_id" property="operatorId" jdbcType="VARCHAR" />
    <result column="station_id" property="stationId" jdbcType="VARCHAR" />
    <result column="insert_time" property="insertTime" jdbcType="TIMESTAMP" />
    <result column="charging_capacity" property="chargingCapacity" jdbcType="DOUBLE" />
    <result column="charging_duration" property="chargingDuration" jdbcType="DOUBLE" />
    <result column="online_duration" property="onlineDuration" jdbcType="DOUBLE" />
    <result column="pole_num" property="poleNum" jdbcType="INTEGER" />
    <result column="charging_num" property="chargingNum" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List">
    sid,station_id, station_name, operator_id, equipment_owner_id, country_code, area_code,
    address, station_tel, service_tel, station_type, station_status, park_nums, station_lng, 
    station_lat, site_guide, construction,  match_cars, park_info, busine_hours,
    electricity_fee, service_fee, park_fee, payment, support_order, park_owner, park_manager, 
    open_all_day, park_free, operate_property, build_date, connection_time, station_principal, 
    property_unit, invest_build_unit, station_land_kind, land_use_time, land_remain_time, 
    station_kind, charge_sum, gun_sum, allowance_status, allowance_price,checkout_status, remark,
    rent_date,invent_extend,station_street,station_property,service_car_type,land_property,operator_property,allowance_date
  </sql>

  <!--故障次数-->
  <select id="getAllChargeErrorNum" resultType="java.lang.Integer">
    SELECT count(DISTINCT id) as charge_error_num
    from  exc_alarm_info
    where station_id=#{stationID} and operator_id = #{operatorID}
  </select>

  <!--地图首页 日充电量-->
  <select id="queryMapChargeEnergyDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  stationChargeStats.insert_time hours,IFNULL(sum(stationChargeStats.charging_capacity),0) charge_electic_sum ,
    IFNULL(sum(stationChargeStats.charging_num),0) charge_num
    from exc_station_statistics_day stationChargeStats, exc_station_info stationInfo
    where
    stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    <if test="stationID != null">
      and stationInfo.station_id=#{stationID}
    </if>
    <if test="operatorID != null">
      and stationInfo.operator_id = #{operatorID}
    </if>
    <if test="startDate != null">
      and stationChargeStats.insert_time &gt;=#{startDate}
    </if>
    <if test="endDate != null">
      and stationChargeStats.insert_time &lt;=#{endDate}
    </if>
    <if test="areaCode != null">
      and stationInfo.area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
      and stationInfo.operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationChargeStats.insert_time ORDER BY stationChargeStats.insert_time;
  </select>

  <select id="queryMapChargeEnergyMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    SELECT sum(stationChargeStats.charging_capacity) charge_electic_sum
    from exc_station_statistics_day stationChargeStats, exc_station_info stationInfo
    where
    stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    <if test="stationID != null">
      and stationInfo.station_id=#{stationID}
    </if>
    <if test="operatorID != null">
      and stationInfo.operator_id = #{operatorID}
    </if>
    <if test="areaCode != null">
      and stationInfo.area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
      and stationInfo.operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    and date_format(stationChargeStats.insert_time,'%Y-%m') = date_format(now(),'%Y-%m')
  </select>

  <select id="queryMapChargeEnergyYear" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    SELECT sum(stationChargeStats.charging_capacity) charge_electic_sum
    from exc_station_statistics_day stationChargeStats, exc_station_info stationInfo
    where
    stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    <if test="stationID != null">
      and stationInfo.station_id=#{stationID}
    </if>
    <if test="operatorID != null">
      and stationInfo.operator_id = #{operatorID}
    </if>
    <if test="areaCode != null">
      and stationInfo.area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
      and stationInfo.operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    and date_format(stationChargeStats.insert_time,'%Y') = date_format(now(),'%Y')
  </select>



  <select id="selectStationByCondition" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="mixedOperatResultMap">
    select a.*,IFNULL(sum(stationDay.charging_capacity),0.0) as charge_electic_sum from
    (select station.*,IFNULL(sum(equipment.power),0.0) as power_sum
    from exc_station_info station LEFT JOIN exc_equipment_info equipment
    on station.station_id=equipment.station_id and station.operator_id=equipment.operator_id
    GROUP BY station.station_id,station.operator_id
    ) a
    LEFT JOIN exc_station_statistics_day stationDay
    on a.station_id=stationDay.station_id and a.operator_id=stationDay.operator_id
    <where>
      1=1
      <if test="statusList != null and statusList.size()>0 ">
        and a.allowance_status in
        <foreach collection="statusList" item="allowanceStatus" index="index" open="(" close=")" separator=",">
          #{allowanceStatus}
        </foreach>
      </if>
      <if test="areaCodeList != null and areaCodeList.size()>0 ">
        and a.area_code in
        <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
          #{areaCode}
        </foreach>
      </if>
      <if test="stationID != null and stationID !=''">
        and a.station_id = #{stationID}
      </if>
      <if test="stationStatus==100">
        and a.station_status !=5
      </if>
      <if test="stationName != null">
        and a.station_name = #{stationName}
      </if>
      <if test="operatorID != null and operatorID !=''">
        and a.operator_id = #{operatorID}
      </if>
      <if test="equipmentOwnerID != null">
        and a.equipment_owner_id = #{equipmentOwnerID}
      </if>
      <if test="countryCode != null">
        and a.country_code = #{countryCode}
      </if>
      <if test="areaCode != null and areaCode !=''">
        and a.area_code = #{areaCode}
      </if>
      <if test="stationStreet !=null and stationStreet !=''">
        and a.station_street = #{stationStreet}
      </if>
      <if test="address != null">
        and a.address = #{address}
      </if>
      <if test="stationTel != null">
        and a.station_tel = #{stationTel}
      </if>
      <if test="serviceTel != null">
        and a.service_tel = #{serviceTel}
      </if>
      <if test="stationType != null">
        and a.station_type = #{stationType}
      </if>
      <if test="stationStatus != null">
        and a.station_status = #{stationStatus}
      </if>
      <if test="parkNums != null">
        and a.park_nums = #{parkNums}
      </if>
      <if test="stationLng != null">
        and a.station_lng = #{stationLng}
      </if>
      <if test="stationLat != null">
        and a.station_lat = #{stationLat}
      </if>
      <if test="siteGuide != null">
        and a.site_guide = #{siteGuide}
      </if>
      <if test="construction != null">
        and a.construction = #{construction}
      </if>
      <if test="matchCars != null">
        and a.match_cars = #{matchCars}
      </if>
      <if test="parkInfo != null">
        and a.park_info = #{parkInfo}
      </if>
      <if test="busineHours != null">
        and a.busine_hours = #{busineHours}
      </if>
      <if test="electricityFee != null">
        and a.electricity_fee = #{electricityFee}
      </if>
      <if test="serviceFee != null">
        and a.service_fee = #{serviceFee}
      </if>
      <if test="parkFee != null">
        and a.park_fee = #{parkFee}
      </if>
      <if test="payment != null">
        and a.payment = #{payment}
      </if>
      <if test="supportOrder != null">
        and a.support_order = #{supportOrder}
      </if>
      <if test="parkOwner != null">
        and a.park_owner = #{parkOwner}
      </if>
      <if test="parkManager != null">
        and a.park_manager = #{parkManager}
      </if>
      <if test="openAllDay != null">
        and a.open_all_day = #{openAllDay}
      </if>
      <if test="parkFree != null">
        and a.park_free = #{parkFree}
      </if>
      <if test="opratorType != null">
        and a.operate_property = #{opratorType}
      </if>
      <if test="buildDate != null">
        and a.build_date = #{buildDate}
      </if>
      <if test="connectionTime != null">
        and a.connection_time = #{connectionTime}
      </if>
      <if test="stationPrincipal != null">
        and a.station_principal = #{stationPrincipal}
      </if>
      <if test="propertyUnit != null">
        and a.property_unit = #{propertyUnit}
      </if>
      <if test="investBuildUnit != null">
        and a.invest_build_unit = #{investBuildUnit}
      </if>
      <if test="stationLandKind != null">
        and a.station_land_kind = #{stationLandKind}
      </if>
      <if test="landUseTime != null">
        and a.land_use_time = #{landUseTime}
      </if>
      <if test="landRemainTime != null">
        and a.land_remain_time = #{landRemainTime}
      </if>
      <if test="stationKind != null">
        and a.station_kind = #{stationKind}
      </if>
      <if test="chargeSum != null">
        and a.charge_sum = #{chargeSum}
      </if>
      <if test="gunSum != null">
        and a.gun_sum = #{gunSum}
      </if>
      <if test="allowanceStatus != null">
        and a.allowance_status = #{allowanceStatus}
      </if>
      <if test="checkoutStatus != null">
        and a.checkout_status = #{checkoutStatus}
      </if>
      <if test="remark != null">
        and a.remark = #{remark}
      </if>
    </where>
    GROUP BY a.station_id,a.operator_id
    ORDER BY a.sid desc
  </select>
  <!--查询告警信息-->
  <select id="selectAlarmInfoByStation" parameterType="com.cpit.cpmt.dto.exchange.basic.AlarmInfo" resultType="com.cpit.cpmt.dto.exchange.basic.AlarmInfo">
    select id,station_id as stationID,operator_id as operatorID,station_name as stationName,
    alarm_status as alarmStatus,alarm_code as alarmCode,alarm_type as alarmType,alarm_level as alarmLevel,
    alarm_time as alarmTime,deal_result as dealResult,note_string as noteString,alarm_desc as alarmDesc
    from exc_alarm_info
    <where>
      <if test="stationID != null">
        station_id = #{stationID}
      </if>
      <if test="operatorID != null">
        and operator_id = #{operatorID}
      </if>
      <if test="equipmentID != null">
        and equipment_id = #{equipmentID}
      </if>
      <if test="alarmTime != null">
        and alarm_time = #{alarmTime}
      </if>
      <if test="alarmType != null">
        and alarm_type = #{alarmType}
      </if>
      <if test="dealResult !=null">
        and deal_result=#{dealResult}
      </if>
    </where>
    ORDER BY id desc
  </select>

  <select id="selectByStationId" resultMap="largeScreenSingleStation">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where station_id = #{stationId} and operator_id = #{operatorId}
  </select>

    <select id="selectSingleStation" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from exc_station_info
        where station_id = #{stationId} and operator_id = #{operatorId}
    </select>

  <select id="getStationsByOperatorId" resultMap="mixedOperatResultMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where operator_id = #{operatorId}
  </select>

  <select id="selectById" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where sid = #{sid}
  </select>
  
  <select id="selectDetailsById" resultMap="mixedOperatResultMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where sid = #{sid}
  </select>

  <select id="selectByPrimaryKey" resultMap="mixedEquipmentResultMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where station_id = #{stationId} and operator_id = #{operatorId}
  </select>

  <select id="selectDynamicByStationId" resultMap="BaseResultMap">
    SELECT IFNULL(sum(stationChargeStats.charging_capacity),0) charge_electic_sum ,IFNULL(sum(charging_num),0) charge_num
    from exc_station_info stationInfo inner join exc_station_statistics_day stationChargeStats
			on stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    where stationInfo.station_id = #{stationId} and stationInfo.operator_id = #{operatorId}
  </select>

  <select id="selectDischargeByStationId" resultType="java.lang.String">
    SELECT  IFNULL(sum(stationDisChargeStats.dis_charging_capacity),0) dis_charge_eletics_sum
    from exc_station_info stationInfo inner JOIN exc_equipment_total_statistics stationDisChargeStats
	on   stationDisChargeStats.station_id=stationInfo.station_id and stationDisChargeStats.operator_id=stationInfo.operator_id
    where stationInfo.station_id = #{stationId} and stationInfo.operator_id = #{operatorId}
  </select>


  <!--充电次数-->
  <select id="selectThermalMapChargeTimesHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d %H') hours,
      IFNULL(connectorCharge.charging_num,0) charge_num
    from exc_station_statistics_hour connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_num!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapChargeTimesDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d') hours,IFNULL(connectorCharge.charging_num,0) charge_num
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_num!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapChargeTimesWeek" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,IFNULL(connectorCharge.charging_num,0) charge_num,
    CONCAT(DATE_FORMAT( subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-7),'%Y-%m-%d')) hours
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_num!=0
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-7),'%Y-%m-%d'))=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapChargeTimesMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m') hours,IFNULL(connectorCharge.charging_num,0) charge_num
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_num!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapChargeTimesQuarter" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,CONCAT(DATE_FORMAT(connectorCharge.insert_time, '%Y'),'年第',QUARTER(connectorCharge.insert_time),'季度') hours,
      IFNULL(connectorCharge.charging_num,0) charge_num
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_num!=0
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT(connectorCharge.insert_time, '%Y'),'年第',QUARTER(connectorCharge.insert_time),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapPowerNowHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d %H') hours,
    IFNULL(ROUND(sum(connectorCharge.charging_capacity) / sum(connectorCharge.charging_duration),2),0) power_sum
    from exc_station_statistics_hour connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapPowerNowDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d') hours,
      IFNULL(ROUND(sum(connectorCharge.charging_capacity) / sum(connectorCharge.charging_duration),2),0) power_sum
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapPowerNowWeek" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,IFNULL(ROUND(sum(connectorCharge.charging_capacity) / sum(connectorCharge.charging_duration),2),0) power_sum,
    CONCAT(DATE_FORMAT( subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-7),'%Y-%m-%d')) hours
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_capacity!=0
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(connectorCharge.insert_time,if(date_format(connectorCharge.insert_time,'%w')=0,7,date_format(connectorCharge.insert_time,'%w'))-7),'%Y-%m-%d'))=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapPowerNowMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(connectorCharge.insert_time, '%Y-%m') hours,
      IFNULL(ROUND(sum(connectorCharge.charging_capacity) / sum(connectorCharge.charging_duration),2),0) power_sum
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(connectorCharge.insert_time, '%Y-%m')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <select id="selectThermalMapPowerNowQuarter" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,CONCAT(DATE_FORMAT(connectorCharge.insert_time, '%Y'),'年第',QUARTER(connectorCharge.insert_time),'季度') hours,
    IFNULL(ROUND(sum(connectorCharge.charging_capacity) / sum(connectorCharge.charging_duration),2),0) power_sum
    from exc_station_statistics_day connectorCharge,  exc_station_info stationInfo
    where connectorCharge.station_id=stationInfo.station_id and connectorCharge.operator_id=stationInfo.operator_id
    and connectorCharge.insert_time &gt;=#{startDate} and connectorCharge.insert_time &lt;=#{endDate}
    and connectorCharge.charging_capacity!=0
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT(connectorCharge.insert_time, '%Y'),'年第',QUARTER(connectorCharge.insert_time),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(connectorCharge.insert_time)
    ORDER BY connectorCharge.insert_time;
  </select>

  <!--充电量-->
  <select id="selectThermalMapChargeNumHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m-%d %H') hours,
    ROUND(sum(stationChargeStats.charging_capacity),2) charge_electic_sum
    from exc_station_statistics_hour stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.insert_time &gt;=#{startDate} and stationChargeStats.insert_time &lt;=#{endDate}
    and stationChargeStats.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id
  </select>

  <select id="selectThermalMapChargeNumDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m-%d') hours,
      sum(stationChargeStats.charging_capacity) charge_electic_sum
    from exc_station_statistics_day stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.insert_time &gt;=#{startDate} and stationChargeStats.insert_time &lt;=#{endDate}
    and stationChargeStats.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(stationChargeStats.insert_time) ORDER BY stationChargeStats.insert_time;
  </select>

  <select id="selectThermalMapChargeNumWeek" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,sum(stationChargeStats.charging_capacity) charge_electic_sum ,
    CONCAT(DATE_FORMAT( subdate(stationChargeStats.insert_time,if(date_format(stationChargeStats.insert_time,'%w')=0,7,date_format(stationChargeStats.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(stationChargeStats.insert_time,if(date_format(stationChargeStats.insert_time,'%w')=0,7,date_format(stationChargeStats.insert_time,'%w'))-7),'%Y-%m-%d')) hours
    from exc_station_statistics_day stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.insert_time &gt;=#{startDate} and stationChargeStats.insert_time &lt;=#{endDate}
    and stationChargeStats.charging_capacity!=0
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(stationChargeStats.insert_time,if(date_format(stationChargeStats.insert_time,'%w')=0,7,date_format(stationChargeStats.insert_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(stationChargeStats.insert_time,if(date_format(stationChargeStats.insert_time,'%w')=0,7,date_format(stationChargeStats.insert_time,'%w'))-7),'%Y-%m-%d')) = #{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(stationChargeStats.insert_time) ORDER BY stationChargeStats.insert_time;
  </select>

  <select id="selectThermalMapChargeNumMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m') hours,
      sum(stationChargeStats.charging_capacity) charge_electic_sum
    from exc_station_statistics_day stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.insert_time &gt;=#{startDate} and stationChargeStats.insert_time &lt;=#{endDate}
    and stationChargeStats.charging_capacity!=0
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.insert_time, '%Y-%m') =#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(stationChargeStats.insert_time) ORDER BY stationChargeStats.insert_time;
  </select>

  <select id="selectThermalMapChargeNumQuarter" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,CONCAT(DATE_FORMAT(stationChargeStats.insert_time, '%Y'),'年第',QUARTER(stationChargeStats.insert_time),'季度') hours,
      sum(stationChargeStats.charging_capacity) charge_electic_sum
    from exc_station_statistics_day stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.insert_time &gt;=#{startDate} and stationChargeStats.insert_time &lt;=#{endDate}
    and stationChargeStats.charging_capacity!=0
    <if test="hours!=null">
          and CONCAT(DATE_FORMAT(stationChargeStats.insert_time,
          '%Y'),'年第',QUARTER(stationChargeStats.insert_time),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(stationChargeStats.insert_time) ORDER BY stationChargeStats.insert_time desc;
  </select>

  <select id="selectThermalMapPowerHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(equipmentInfo.in_date, '%Y-%m-%d %H') hours,sum(equipmentInfo.power) power_sum
    from  exc_station_info stationInfo, exc_equipment_info equipmentInfo
    where equipmentInfo.station_id=stationInfo.station_id and equipmentInfo.operator_id=stationInfo.operator_id
    and equipmentInfo.in_date &gt;=#{startDate} and equipmentInfo.in_date &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(equipmentInfo.in_date, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,HOUR(equipmentInfo.in_date) ORDER BY equipmentInfo.in_date;
  </select>

  <select id="selectThermalMapPowerDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(equipmentInfo.in_date, '%Y-%m-%d') hours,sum(equipmentInfo.power) power_sum
    from  exc_station_info stationInfo, exc_equipment_info equipmentInfo
    where equipmentInfo.station_id=stationInfo.station_id and equipmentInfo.operator_id=stationInfo.operator_id
    and equipmentInfo.in_date &gt;=#{startDate} and equipmentInfo.in_date &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(equipmentInfo.in_date, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(equipmentInfo.in_date) ORDER BY equipmentInfo.in_date;
  </select>

  <select id="selectThermalMapPowerWeek" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,YEARWEEK(equipmentInfo.in_date) hours,sum(equipmentInfo.power) power_sum,
    CONCAT(DATE_FORMAT( subdate(equipmentInfo.in_date,if(date_format(equipmentInfo.in_date,'%w')=0,7,date_format(equipmentInfo.in_date,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(equipmentInfo.in_date,if(date_format(equipmentInfo.in_date,'%w')=0,7,date_format(equipmentInfo.in_date,'%w'))-7),'%Y-%m-%d')) hours
    from  exc_station_info stationInfo, exc_equipment_info equipmentInfo
    where equipmentInfo.station_id=stationInfo.station_id and equipmentInfo.operator_id=stationInfo.operator_id
    and equipmentInfo.in_date &gt;=#{startDate} and equipmentInfo.in_date &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(equipmentInfo.in_date,if(date_format(equipmentInfo.in_date,'%w')=0,7,date_format(equipmentInfo.in_date,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(equipmentInfo.in_date,if(date_format(equipmentInfo.in_date,'%w')=0,7,date_format(equipmentInfo.in_date,'%w'))-7),'%Y-%m-%d'))=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(equipmentInfo.in_date) ORDER BY equipmentInfo.in_date;
  </select>

  <select id="selectThermalMapPowerMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(equipmentInfo.in_date, '%Y-%m') hours,sum(equipmentInfo.power) power_sum
    from  exc_station_info stationInfo, exc_equipment_info equipmentInfo
    where equipmentInfo.station_id=stationInfo.station_id and equipmentInfo.operator_id=stationInfo.operator_id
    and equipmentInfo.in_date &gt;=#{startDate} and equipmentInfo.in_date &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(equipmentInfo.in_date, '%Y-%m')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(equipmentInfo.in_date) ORDER BY equipmentInfo.in_date;
  </select>


  <select id="selectThermalMapPowerQuarter" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    select stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code, CONCAT(DATE_FORMAT(equipmentInfo.in_date, '%Y'),'年第',QUARTER(equipmentInfo.in_date),'季度') hours,sum(equipmentInfo.power) power_sum
    from  exc_station_info stationInfo, exc_equipment_info equipmentInfo
    where equipmentInfo.station_id=stationInfo.station_id and equipmentInfo.operator_id=stationInfo.operator_id
    and equipmentInfo.in_date &gt;=#{startDate} and equipmentInfo.in_date &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT(equipmentInfo.in_date, '%Y'),'年第',QUARTER(equipmentInfo.in_date),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(equipmentInfo.in_date) ORDER BY equipmentInfo.in_date;
  </select>

  <select id="getFaultRate" parameterType="com.cpit.cpmt.dto.exchange.operator.EquipmentInfoShow" resultType="java.lang.String">
    select CONCAT(IFNULL(ROUND(
    (SELECT  IFNULL(count(connectorSta.id),0)
      from  exc_connector_status_info connectorSta,exc_connector_info connect,exc_equipment_info equipment
    where connectorSta.operator_id=connect.operator_id and connectorSta.connector_id=connect.connector_id
    and equipment.operator_id=connect.operator_id and equipment.equipment_id=connect.equipment_id
    <if test="operatorID!=null">
      and equipment.operator_id=#{operatorID}
    </if>
    <if test="equipmentID!=null">
      and equipment.equipment_id=#{equipmentID}
    </if>
    <if test="stationId!=null">
      and equipment.station_id=#{stationId}
    </if>
      and connectorSta.status='255')
    /
    (SELECT  IFNULL(count(connectorSta.id),0)
    from  exc_connector_status_info connectorSta,exc_connector_info connect,exc_equipment_info equipment
    where connectorSta.operator_id=connect.operator_id and connectorSta.connector_id=connect.connector_id
    and equipment.operator_id=connect.operator_id and equipment.equipment_id=connect.equipment_id
    <if test="operatorID!=null">
      and equipment.operator_id=#{operatorID}
    </if>
    <if test="equipmentID!=null">
      and equipment.equipment_id=#{equipmentID}
    </if>
    <if test="stationId!=null">
      and equipment.station_id=#{stationId}
    </if>
    )* 100,2),0),'%')


  </select>


    <select id="getServiceTime"  resultType="java.lang.String">
        select CONCAT(timestampdiff(HOUR,connection_time,SYSDATE()),' h')
        from exc_station_info
        where operator_id=#{operatorId} and station_id=#{stationId}
    </select>


  <select id="selectThermalMapFaultRateHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  b.station_name station_name,b.station_lng station_lng,b.station_lat station_lat,b.hours hours,
        CONCAT(IFNULL(ROUND(a.fault / b.allNum * 100,2),0),'%') charge_electic_sum
    from
    (select stationInfo.station_id,stationInfo.operator_id, DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d %H') hours,count(stationChargeStats.id)  fault
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.`status`='255'
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,HOUR(stationChargeStats.in_time)) a

    RIGHT JOIN

    (select stationInfo.station_id,stationInfo.operator_id, stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d %H') hours,count(stationChargeStats.id) allNum
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,HOUR(stationChargeStats.in_time))b
    on a.station_id=b.station_id and a.operator_id=b.operator_id and a.hours=b.hours
  </select>

  <select id="selectThermalMapFaultRateDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  b.station_name station_name,b.station_lng station_lng,b.station_lat station_lat,b.hours hours,
    CONCAT(IFNULL(ROUND(a.fault / b.allNum * 100,2),0),'%') charge_electic_sum
    from
    (select stationInfo.station_id,stationInfo.operator_id, DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d') hours,count(stationChargeStats.id)  fault
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.`status`='255'
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(stationChargeStats.in_time)) a

    RIGHT JOIN

    (select stationInfo.station_id,stationInfo.operator_id, stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d') hours,count(stationChargeStats.id) allNum
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m-%d')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,DAY(stationChargeStats.in_time))b
    on a.station_id=b.station_id and a.operator_id=b.operator_id and a.hours=b.hours
  </select>

  <select id="selectThermalMapFaultRateWeek" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  b.station_name station_name,b.station_lng station_lng,b.station_lat station_lat,b.hours hours,
    CONCAT(IFNULL(ROUND(a.fault / b.allNum * 100,2),0),'%') charge_electic_sum
    from
    (select stationInfo.station_id,stationInfo.operator_id, CONCAT(DATE_FORMAT( subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-7),'%Y-%m-%d')) hours,count(stationChargeStats.id)  fault
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.`status`='255'
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-7),'%Y-%m-%d'))=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(stationChargeStats.in_time)) a

    RIGHT JOIN

    (select stationInfo.station_id,stationInfo.operator_id, stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,CONCAT(DATE_FORMAT( subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
    DATE_FORMAT(subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-7),'%Y-%m-%d')) hours,count(stationChargeStats.id) allNum
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT( subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-1),'%Y-%m-%d'),' ~ ',
      DATE_FORMAT(subdate(stationChargeStats.in_time,if(date_format(stationChargeStats.in_time,'%w')=0,7,date_format(stationChargeStats.in_time,'%w'))-7),'%Y-%m-%d'))=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,YEARWEEK(stationChargeStats.in_time))b
    on a.station_id=b.station_id and a.operator_id=b.operator_id and a.hours=b.hours
  </select>

  <select id="selectThermalMapFaultRateMonth" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  b.station_name station_name,b.station_lng station_lng,b.station_lat station_lat,b.hours hours,
    CONCAT(IFNULL(ROUND(a.fault / b.allNum * 100,2),0),'%') charge_electic_sum
    from
    (select stationInfo.station_id,stationInfo.operator_id, DATE_FORMAT(stationChargeStats.in_time, '%Y-%m') hours,count(stationChargeStats.id)  fault
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.`status`='255'
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(stationChargeStats.in_time)) a

    RIGHT JOIN

    (select stationInfo.station_id,stationInfo.operator_id, stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,DATE_FORMAT(stationChargeStats.in_time, '%Y-%m') hours,count(stationChargeStats.id) allNum
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(stationChargeStats.in_time, '%Y-%m')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,MONTH(stationChargeStats.in_time))b
    on a.station_id=b.station_id and a.operator_id=b.operator_id and a.hours=b.hours
  </select>

  <select id="selectThermalMapFaultRateQuarter" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT  b.station_name station_name,b.station_lng station_lng,b.station_lat station_lat,b.hours hours,
    CONCAT(IFNULL(ROUND(a.fault / b.allNum * 100,2),0),'%') charge_electic_sum
    from
    (select stationInfo.station_id,stationInfo.operator_id, CONCAT(DATE_FORMAT(stationChargeStats.in_time, '%Y'),'年第',QUARTER(stationChargeStats.in_time),'季度') hours,count(stationChargeStats.id)  fault
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.`status`='255'
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT(stationChargeStats.in_time, '%Y'),'年第',QUARTER(stationChargeStats.in_time),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(stationChargeStats.in_time)) a

    RIGHT JOIN

    (select stationInfo.station_id,stationInfo.operator_id, stationInfo.station_name station_name,stationInfo.station_lng station_lng,stationInfo.station_lat station_lat,
    stationInfo.area_code area_code,CONCAT(DATE_FORMAT(stationChargeStats.in_time, '%Y'),'年第',QUARTER(stationChargeStats.in_time),'季度') hours,count(stationChargeStats.id) allNum
    from exc_connector_status_info stationChargeStats,  exc_station_info stationInfo
    where stationChargeStats.station_id=stationInfo.station_id and stationChargeStats.operator_id=stationInfo.operator_id
    and stationChargeStats.in_time &gt;=#{startDate} and stationChargeStats.in_time &lt;=#{endDate}
    <if test="hours!=null">
      and CONCAT(DATE_FORMAT(stationChargeStats.in_time, '%Y'),'年第',QUARTER(stationChargeStats.in_time),'季度')=#{hours}
    </if>
    <if test="operatorID!=null">
      and stationInfo.operator_id=#{operatorID}
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
    GROUP BY stationInfo.station_id,QUARTER(stationChargeStats.in_time))b
    on a.station_id=b.station_id and a.operator_id=b.operator_id and a.hours=b.hours
  </select>

  <!--<select id="selectBigScreenChargeNumByArea" resultMap="BaseResultMap">
    SELECT areas.area_name area_code,IFNULL(b.charge_num,0) charge_num
    from sys_area_dict areas LEFT JOIN
    (select area.area_code,ROUND(count(0)/10) charge_num
        from sys_area_dict area left join exc_station_info stationInfo on area.area_code=stationInfo.area_code
        LEFT JOIN exc_equipment_info equipment on stationInfo.station_id=equipment.station_id and stationInfo.operator_id=equipment.operator_id
        LEFT JOIN exc_connector_info connector on connector.equipment_id=equipment.equipment_id and connector.operator_id=equipment.operator_id
        LEFT JOIN exc_connector_proc_data a on connector.connector_id=a.connector_id and connector.operator_id=a.operator_id
        where  a.status = '3'
        GROUP BY stationInfo.area_code) b
    on areas.area_code=b.area_code
     ORDER BY charge_num DESC
  </select>-->
  <select id="selectBigScreenChargeNumByArea" resultMap="BaseResultMap">
    SELECT areas.area_name area_code,IFNULL(b.charge_num,0) charge_num
    from sys_area_dict areas LEFT JOIN
    (SELECT station.area_code,sum(connectCharge.charging_num) charge_num
    from exc_station_statistics_day connectCharge , exc_station_info station
    where connectCharge.operator_id=station.operator_id and  connectCharge.station_id=station.station_id
    GROUP BY station.area_code) b
    on areas.area_code=b.area_code
     ORDER BY charge_num DESC
  </select>

  <!--<select id="selectBigScreenChargeNumByOperator" resultMap="BaseResultMap">
    SELECT operators.operator_name operator_id,IFNULL(b.charge_num,0) charge_num
    from exc_operator_info operators LEFT JOIN
       ( select
      operator.operator_id,ROUND(count(0)/10) charge_num
      from exc_operator_info operator left join exc_station_info stationInfo on operator.operator_id=stationInfo.operator_id
      LEFT JOIN exc_equipment_info equipment on stationInfo.station_id=equipment.station_id and stationInfo.operator_id=equipment.operator_id
      LEFT JOIN exc_connector_info connector on connector.equipment_id=equipment.equipment_id and connector.operator_id=equipment.operator_id
      LEFT JOIN exc_connector_proc_data a on connector.connector_id=a.connector_id and connector.operator_id=a.operator_id
        where  a.status = '3'
      GROUP BY stationInfo.operator_id )b
    on operators.operator_id=b.operator_id
    ORDER BY charge_num DESC  LIMIT 10;
  </select>-->
  <select id="selectBigScreenChargeNumByOperator" resultMap="BaseResultMap">
    SELECT operators.operator_name operator_id,IFNULL(b.charge_num,0) charge_num
    from exc_operator_info operators LEFT JOIN
       ( SELECT station.operator_id,sum(connectCharge.charging_num) charge_num
      from exc_station_statistics_day connectCharge , exc_station_info station
      where connectCharge.operator_id=station.operator_id and  connectCharge.station_id=station.station_id
      GROUP BY station.operator_id)b
    on operators.operator_id=b.operator_id
    ORDER BY charge_num DESC  LIMIT 10;
  </select>
  
  <select id="selectBigScreenUseRateByArea" resultMap="BaseResultMap">
SELECT a.area_name area_code, IFNULL(ROUND(a.cc / b.cc * 100,2),0)  charge_electic_sum
	from
	(
select ten.area_code,ten.area_name, IFNULL((ten.cc-twenty.cc),0.0) cc from
	(
			select stationInfo.area_code, area.area_name, IFNULL(sum(charge_electricity),0.0) cc from
				exc_connector_history_power_info pow , exc_station_info stationInfo,sys_area_dict area
			where pow.station_id = stationInfo.station_id and pow.operator_id = stationInfo.operator_id and area.area_code=stationInfo.area_code
			and pow.in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 10 MINUTE
		GROUP BY stationInfo.area_code
	) ten
	 LEFT JOIN
	(
			select stationInfo.area_code, IFNULL(sum(charge_electricity),0.0) cc from
				exc_connector_history_power_info pow , exc_station_info stationInfo
			where pow.station_id = stationInfo.station_id and pow.operator_id = stationInfo.operator_id
			and pow.in_time BETWEEN DATE_ADD(NOW(), INTERVAL -20 MINUTE)  and DATE_ADD(NOW(), INTERVAL -10 MINUTE)
			GROUP BY stationInfo.area_code
	) twenty on ten.area_code=twenty.area_code
) a

LEFT JOIN
 ( select stationInfo.area_code , IFNULL(sum(equipment.equipment_power),0.0)*1.667 cc from
		(
			select  station_id,equipment_id,operator_id  from
			exc_connector_history_power_info
			where in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 10 MINUTE
			GROUP BY connector_id,operator_id
		) pow, exc_equipment_info equipment , exc_station_info stationInfo
        where  pow.station_id = stationInfo.station_id and pow.operator_id = stationInfo.operator_id
and pow.equipment_id=equipment.equipment_id and pow.operator_id=equipment.operator_id
    GROUP BY stationInfo.area_code
)b
	on a.area_code=b.area_code
	ORDER BY IFNULL(ROUND(a.cc / b.cc * 100,2),0) DESC
  </select>
  
  <select id="selectBigScreenUseRateByOperator" resultMap="BaseResultMap">
SELECT a.operator_name operator_id, IFNULL(ROUND(a.cc / b.cc * 100,2),0)  charge_electic_sum
	from
	(
select ten.operator_id,ten.operator_name, IFNULL((ten.cc-twenty.cc),0.0) cc from
	(
			select operator.operator_id, operator.operator_name, IFNULL(sum(pow.charge_electricity),0.0) cc from
				exc_connector_history_power_info pow , exc_operator_info operator
			where  operator.operator_id=pow.operator_id
			and pow.in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 10 MINUTE
		GROUP BY operator.operator_id
	) ten
	 LEFT JOIN
	(
			select operator.operator_id, IFNULL(sum(charge_electricity),0.0) cc from
				exc_connector_history_power_info pow , exc_operator_info operator
			where  operator.operator_id=pow.operator_id
			and pow.in_time BETWEEN DATE_ADD(NOW(), INTERVAL -20 MINUTE)  and DATE_ADD(NOW(), INTERVAL -10 MINUTE)
			GROUP BY operator.operator_id
	) twenty on ten.operator_id=twenty.operator_id
) a

LEFT JOIN
 ( select operator.operator_id, IFNULL(sum(equipment.equipment_power),0.0)*1.667 cc from
		(
			select  equipment_id,operator_id  from
			exc_connector_history_power_info
			where in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 10 MINUTE
			GROUP BY connector_id,operator_id
		) pow, exc_equipment_info equipment , exc_operator_info operator
			where  operator.operator_id=pow.operator_id
		and pow.equipment_id=equipment.equipment_id and pow.operator_id=equipment.operator_id
    GROUP BY operator.operator_id
)b
	on a.operator_id=b.operator_id
	ORDER BY IFNULL(ROUND(a.cc / b.cc * 100,2),0) DESC
  </select>
  
<!--  <select id="selectBigScreenChargeNum" resultMap="BaseResultMap">
    select  sum(connectorCharge.charge_last_time) power_sum
    from exc_station_info station , exc_connector_charge_info connectorCharge
    where  station.station_id=connectorCharge.station_id and station.operator_id=connectorCharge.operator_id
  </select>-->

<!--  <select id="selectBigScreenChargeNums" resultType="java.lang.Integer">
    select ROUND(count(0)/10) charge_num
  from  exc_station_info stationInfo
  LEFT JOIN exc_equipment_info equipment on stationInfo.station_id=equipment.station_id and stationInfo.operator_id=equipment.operator_id
  LEFT JOIN exc_connector_info connector on connector.equipment_id=equipment.equipment_id and connector.operator_id=equipment.operator_id
  LEFT JOIN exc_connector_proc_data a on connector.connector_id=a.connector_id and connector.operator_id=a.operator_id
      where  a.status = '3'
  </select>-->
  
  <select id="selectBigScreenChargeAmount" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    select SUM(stationChargeSta.charging_capacity) station_lng
    from exc_station_statistics_day stationChargeSta,exc_station_info stationInfo
    where stationInfo.station_id=stationChargeSta.station_id and stationInfo.operator_id=stationChargeSta.operator_id
    <if test="stationID != null and stationID !=''">
      and stationInfo.station_id=#{stationID}
    </if>
    <if test="operatorID != null and operatorID !=''">
      and stationInfo.operator_id = #{operatorID}
    </if>
    <if test="areaCode != null and areaCode !=''">
      and stationInfo.area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
      and stationInfo.operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
</select>

  <select id="selectBigScreenChargeInfo" resultMap="BaseResultMap">
    select sum(connectorCharge.charging_duration) power_sum,sum(connectorCharge.charging_num) checkout_status
    from exc_station_info station LEFT JOIN exc_station_statistics_day connectorCharge
    on station.station_id=connectorCharge.station_id and station.operator_id=connectorCharge.operator_id
  </select>

  <select id="selectChargeCounts" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Integer">
    select SUM(stationChargeSta.charging_num) a
        from exc_station_statistics_day stationChargeSta,exc_station_info stationInfo
        where stationInfo.station_id=stationChargeSta.station_id and stationInfo.operator_id=stationChargeSta.operator_id
        <if test="stationID != null">
          and stationInfo.station_id=#{stationID}
        </if>
        <if test="operatorID != null">
          and stationInfo.operator_id = #{operatorID}
        </if>
        <if test="areaCode != null">
          and stationInfo.area_code = #{areaCode}
        </if>
        <if test="operatorIdList != null and operatorIdList.size()>0 ">
          and stationInfo.operator_id in
          <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
            #{operatorID}
          </foreach>
        </if>
        <if test="areaCodeList != null and areaCodeList.size()>0 ">
          and stationInfo.area_code in
          <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
            #{areaCode}
          </foreach>
        </if>
  </select>
  
  <select id="selectChargeNumberToday" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    select ROUND(SUM(connectorPower.charge_elec),2) station_lng
    from exc_connector_charge_info  connectorPower inner join exc_station_info stationInfo
    on stationInfo.station_id=connectorPower.station_id and stationInfo.operator_id=connectorPower.operator_id
    where connectorPower.in_time>= FROM_UNIXTIME(UNIX_TIMESTAMP(CAST(SYSDATE()AS DATE)))  and SYSDATE()
    <if test="stationID != null and stationID !=''">
      and stationInfo.station_id=#{stationID}
    </if>
    <if test="operatorID != null and operatorID !=''">
      and stationInfo.operator_id = #{operatorID}
    </if>
    <if test="areaCode != null and areaCode !=''">
      and stationInfo.area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
      and stationInfo.operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
      and stationInfo.area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
  </select>

  <select id="getStationInfoByBatchId" parameterType="java.lang.String" resultMap="allowanceMap">
    select b.*
    from
    (select distinct sid from exc_allowance_equipment where batch_id=#{batchId}) a
    left join exc_station_info b on a.sid=b.sid
  </select>

  <select id="getMapStationByPower" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List" />
    from exc_station_info
    where
      1=1
    <if test="stationID != null">
      and station_id = #{stationID}
    </if>
    <if test="stationName != null">
      and station_name like "%" #{stationName} "%"
    </if>
    <if test="operatorID != null">
      and operator_id = #{operatorID}
    </if>
    <if test="areaCode != null">
      and area_code = #{areaCode}
    </if>
    <if test="operatorIdList != null and operatorIdList.size()>0 ">
        and operator_id in
      <foreach collection="operatorIdList" item="operatorID" index="index" open="(" close=")" separator=",">
        #{operatorID}
      </foreach>
    </if>
    <if test="areaCodeList != null and areaCodeList.size()>0 ">
        and area_code in
      <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
        #{areaCode}
      </foreach>
    </if>
  </select>
  <select id="getMapOperAndEquipList" resultMap="mixedMapStationResultMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where station_id = #{stationId} and operator_id = #{operatorId}
  </select>
  <select id="getChargeMapByOne" resultMap="chargeMapStationMap">
    select
    <include refid="Base_Column_List" />
    from exc_station_info
    where station_id = #{stationId} and operator_id = #{operatorId}
  </select>
  <delete id="deleteByPrimaryKey">
    delete from exc_station_info
    where station_id = #{stationID} and operator_id = #{operatorID}
  </delete>

  <insert id="insertSelective" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow">
    insert into exc_station_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="sid != null">
        sid,
      </if>
      <if test="stationID != null">
        station_id,
      </if>
      <if test="stationName != null">
        station_name,
      </if>
      <if test="operatorID != null">
        operator_id,
      </if>
      <if test="equipmentOwnerID != null">
        equipment_owner_id,
      </if>
      <if test="countryCode != null">
        country_code,
      </if>
      <if test="areaCode != null">
        area_code,
      </if>
      <if test="address != null">
        address,
      </if>
      <if test="stationTel != null">
        station_tel,
      </if>
      <if test="serviceTel != null">
        service_tel,
      </if>
      <if test="stationType != null">
        station_type,
      </if>
      <if test="stationStatus != null">
        station_status,
      </if>
      <if test="parkNums != null">
        park_nums,
      </if>
      <if test="stationLng != null">
        station_lng,
      </if>
      <if test="stationLat != null">
        station_lat,
      </if>
      <if test="siteGuide != null">
        site_guide,
      </if>
      <if test="construction != null">
        construction,
      </if>
      <if test="matchCars != null">
        match_cars,
      </if>
      <if test="parkInfo != null">
        park_info,
      </if>
      <if test="busineHours != null">
        busine_hours,
      </if>
      <if test="electricityFee != null">
        electricity_fee,
      </if>
      <if test="serviceFee != null">
        service_fee,
      </if>
      <if test="parkFee != null">
        park_fee,
      </if>
      <if test="payment != null">
        payment,
      </if>
      <if test="supportOrder != null">
        support_order,
      </if>
      <if test="parkOwner != null">
        park_owner,
      </if>
      <if test="parkManager != null">
        park_manager,
      </if>
      <if test="openAllDay != null">
        open_all_day,
      </if>
      <if test="parkFree != null">
        park_free,
      </if>
      <if test="opratorType != null">
        operate_property,
      </if>
      <if test="buildDate != null">
        build_date,
      </if>
      <if test="connectionTime != null">
        connection_time,
      </if>
      <if test="stationPrincipal != null">
        station_principal,
      </if>
      <if test="propertyUnit != null">
        property_unit,
      </if>
      <if test="investBuildUnit != null">
        invest_build_unit,
      </if>
      <if test="stationLandKind != null">
        station_land_kind,
      </if>
      <if test="landUseTime != null">
        land_use_time,
      </if>
      <if test="landRemainTime != null">
        land_remain_time,
      </if>
      <if test="stationKind != null">
        station_kind,
      </if>
      <if test="chargeSum != null">
        charge_sum,
      </if>
      <if test="gunSum != null">
        gun_sum,
      </if>
      <if test="allowanceStatus != null">
        allowance_status,
      </if>
      <if test="allowancePrice != null">
        allowance_price,
      </if>
      <if test="allowanceDate != null">
        allowance_date,
      </if>
      <if test="checkoutStatus != null">
        checkout_status,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="rentDate != null">
        rent_date,
      </if>
      <if test="inventExtend != null">
        invent_extend,
      </if>
      <if test="stationStreet != null">
        station_street,
      </if>
      <if test="stationProperty != null">
        station_property,
      </if>
      <if test="serviceCarType != null">
        service_car_type,
      </if>
      <if test="landProperty != null">
        land_property,
      </if>
      <if test="operatorProperty != null">
        operator_property,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="sid != null">
        #{sid},
      </if>
      <if test="stationID != null">
        #{stationID},
      </if>
      <if test="stationName != null">
        #{stationName},
      </if>
      <if test="operatorID != null">
        #{operatorID},
      </if>
      <if test="equipmentOwnerID != null">
        #{equipmentOwnerID},
      </if>
      <if test="countryCode != null">
        #{countryCode},
      </if>
      <if test="areaCode != null">
        #{areaCode},
      </if>
      <if test="address != null">
        #{address},
      </if>
      <if test="stationTel != null">
        #{stationTel},
      </if>
      <if test="serviceTel != null">
        #{serviceTel},
      </if>
      <if test="stationType != null">
        #{stationType},
      </if>
      <if test="stationStatus != null">
        #{stationStatus},
      </if>
      <if test="parkNums != null">
        #{parkNums},
      </if>
      <if test="allowanceDate != null">
        #{allowanceDate},
      </if>
      <if test="stationLng != null">
        #{stationLng},
      </if>
      <if test="stationLat != null">
        #{stationLat},
      </if>
      <if test="siteGuide != null">
        #{siteGuide},
      </if>
      <if test="construction != null">
        #{construction},
      </if>
      <if test="matchCars != null">
        #{matchCars},
      </if>
      <if test="parkInfo != null">
        #{parkInfo},
      </if>
      <if test="busineHours != null">
        #{busineHours},
      </if>
      <if test="electricityFee != null">
        #{electricityFee},
      </if>
      <if test="serviceFee != null">
        #{serviceFee},
      </if>
      <if test="parkFee != null">
        #{parkFee},
      </if>
      <if test="payment != null">
        #{payment},
      </if>
      <if test="supportOrder != null">
        #{supportOrder},
      </if>
      <if test="parkOwner != null">
        #{parkOwner},
      </if>
      <if test="parkManager != null">
        #{parkManager},
      </if>
      <if test="openAllDay != null">
        #{openAllDay},
      </if>
      <if test="parkFree != null">
        #{parkFree},
      </if>
      <if test="opratorType != null">
        #{opratorType},
      </if>
      <if test="buildDate != null">
        #{buildDate},
      </if>
      <if test="connectionTime != null">
        #{connectionTime},
      </if>
      <if test="stationPrincipal != null">
        #{stationPrincipal},
      </if>
      <if test="propertyUnit != null">
        #{propertyUnit},
      </if>
      <if test="investBuildUnit != null">
        #{investBuildUnit},
      </if>
      <if test="stationLandKind != null">
        #{stationLandKind},
      </if>
      <if test="landUseTime != null">
        #{landUseTime},
      </if>
      <if test="landRemainTime != null">
        #{landRemainTime},
      </if>
      <if test="stationKind != null">
        #{stationKind},
      </if>
      <if test="chargeSum != null">
        #{chargeSum},
      </if>
      <if test="gunSum != null">
        #{gunSum},
      </if>
      <if test="allowanceStatus != null">
        #{allowanceStatus},
      </if>
      <if test="allowancePrice != null">
        #{allowancePrice},
      </if>
      <if test="checkoutStatus != null">
        #{checkoutStatus},
      </if>
      <if test="remark != null">
        #{remark},
      </if>
      <if test="rentDate != null">
        #{rentDate},
      </if>
      <if test="inventExtend != null">
        #{inventExtend},
      </if>
      <if test="stationStreet != null">
        #{stationStreet},
      </if>
      <if test="stationProperty != null">
        #{stationProperty},
      </if>
      <if test="serviceCarType != null">
        #{serviceCarType},
      </if>
      <if test="landProperty != null">
        #{landProperty},
      </if>
      <if test="operatorProperty != null">
        #{operatorProperty},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow">
    update exc_station_info
    <set>
      <if test="stationName != null">
        station_name = #{stationName},
      </if>
      <if test="equipmentOwnerID != null">
        equipment_owner_id = #{equipmentOwnerID},
      </if>
      <if test="countryCode != null">
        country_code = #{countryCode},
      </if>
      <if test="areaCode != null">
        area_code = #{areaCode},
      </if>
      <if test="allowanceDate != null">
        allowance_date=#{allowanceDate},
      </if>
      <if test="address != null">
        address = #{address},
      </if>
      <if test="stationTel != null">
        station_tel = #{stationTel},
      </if>
      <if test="serviceTel != null">
        service_tel = #{serviceTel},
      </if>
      <if test="stationType != null">
        station_type = #{stationType},
      </if>
      <if test="stationStatus != null">
        station_status = #{stationStatus},
      </if>
      <if test="parkNums != null">
        park_nums = #{parkNums},
      </if>
      <if test="stationLng != null">
        station_lng = #{stationLng},
      </if>
      <if test="stationLat != null">
        station_lat = #{stationLat},
      </if>
      <if test="siteGuide != null">
        site_guide = #{siteGuide},
      </if>
      <if test="construction != null">
        construction = #{construction},
      </if>
      <if test="matchCars != null">
        match_cars = #{matchCars},
      </if>
      <if test="parkInfo != null">
        park_info = #{parkInfo},
      </if>
      <if test="busineHours != null">
        busine_hours = #{busineHours},
      </if>
      <if test="electricityFee != null">
        electricity_fee = #{electricityFee},
      </if>
      <if test="serviceFee != null">
        service_fee = #{serviceFee},
      </if>
      <if test="parkFee != null">
        park_fee = #{parkFee},
      </if>
      <if test="payment != null">
        payment = #{payment},
      </if>
      <if test="supportOrder != null">
        support_order = #{supportOrder},
      </if>
      <if test="parkOwner != null">
        park_owner = #{parkOwner},
      </if>
      <if test="parkManager != null">
        park_manager = #{parkManager},
      </if>
      <if test="openAllDay != null">
        open_all_day = #{openAllDay},
      </if>
      <if test="parkFree != null">
        park_free = #{parkFree},
      </if>
      <if test="opratorType != null">
        operate_property = #{opratorType},
      </if>
      <if test="buildDate != null">
        build_date = #{buildDate},
      </if>
      <if test="connectionTime != null">
        connection_time = #{connectionTime},
      </if>
      <if test="stationPrincipal != null">
        station_principal = #{stationPrincipal},
      </if>
      <if test="propertyUnit != null">
        property_unit = #{propertyUnit},
      </if>
      <if test="investBuildUnit != null">
        invest_build_unit = #{investBuildUnit},
      </if>
      <if test="stationLandKind != null">
        station_land_kind = #{stationLandKind},
      </if>
      <if test="landUseTime != null">
        land_use_time = #{landUseTime},
      </if>
      <if test="landRemainTime != null">
        land_remain_time = #{landRemainTime},
      </if>
      <if test="stationKind != null">
        station_kind = #{stationKind},
      </if>
      <if test="chargeSum != null">
        charge_sum = #{chargeSum},
      </if>
      <if test="gunSum != null">
        gun_sum = #{gunSum},
      </if>
      <if test="allowanceStatus != null">
        allowance_status = #{allowanceStatus},
      </if>
      <if test="allowancePrice != null">
        allowance_price = #{allowancePrice},
      </if>
      <if test="checkoutStatus != null">
        checkout_status = #{checkoutStatus},
      </if>
      <if test="remark != null">
        remark = #{remark},
      </if>
      <if test="rentDate != null">
        rent_date = #{rentDate},
      </if>
      <if test="inventExtend != null">
        invent_extend = #{inventExtend},
      </if>
      <if test="stationStreet != null">
        station_street = #{stationStreet},
      </if>
      <if test="stationProperty != null">
        station_property = #{stationProperty},
      </if>
      <if test="serviceCarType != null">
        service_car_type = #{serviceCarType},
      </if>
      <if test="landProperty != null">
        land_property = #{landProperty},
      </if>
      <if test="operatorProperty != null">
        operator_property = #{operatorProperty},
      </if>
    </set>
    where   operator_id = #{operatorID}
    <if test="stationID != null">
      and station_id = #{stationID}
    </if>
  </update>

  <update id="updateStationSelective" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow">
    update exc_station_info
    <set>
      <if test="stationName != null">
        station_name = #{stationName},
      </if>
      <if test="equipmentOwnerID != null">
        equipment_owner_id = #{equipmentOwnerID},
      </if>
      <if test="countryCode != null">
        country_code = #{countryCode},
      </if>
      <if test="areaCode != null">
        area_code = #{areaCode},
      </if>
      <if test="address != null">
        address = #{address},
      </if>
      <if test="stationTel != null">
        station_tel = #{stationTel},
      </if>
      <if test="serviceTel != null">
        service_tel = #{serviceTel},
      </if>
      <if test="stationType != null">
        station_type = #{stationType},
      </if>
      <if test="stationStatus != null">
        station_status = #{stationStatus},
      </if>
      <if test="parkNums != null">
        park_nums = #{parkNums},
      </if>
      <if test="stationLng != null">
        station_lng = #{stationLng},
      </if>
      <if test="stationLat != null">
        station_lat = #{stationLat},
      </if>
      <if test="siteGuide != null">
        site_guide = #{siteGuide},
      </if>
      <if test="construction != null">
        construction = #{construction},
      </if>
      <if test="matchCars != null">
        match_cars = #{matchCars},
      </if>
      <if test="parkInfo != null">
        park_info = #{parkInfo},
      </if>
      <if test="busineHours != null">
        busine_hours = #{busineHours},
      </if>
      <if test="electricityFee != null">
        electricity_fee = #{electricityFee},
      </if>
      <if test="serviceFee != null">
        service_fee = #{serviceFee},
      </if>
      <if test="parkFee != null">
        park_fee = #{parkFee},
      </if>
      <if test="payment != null">
        payment = #{payment},
      </if>
      <if test="supportOrder != null">
        support_order = #{supportOrder},
      </if>
      <if test="parkOwner != null">
        park_owner = #{parkOwner},
      </if>
      <if test="parkManager != null">
        park_manager = #{parkManager},
      </if>
      <if test="openAllDay != null">
        open_all_day = #{openAllDay},
      </if>
      <if test="parkFree != null">
        park_free = #{parkFree},
      </if>
      <if test="opratorType != null">
        operate_property = #{opratorType},
      </if>
    </set>
    where   operator_id = #{operatorID} and station_id = #{stationID}
  </update>

  <!--<select id="selectStationRiskLevel" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="mixedStationResultMap">
    select station_id,station_name,operator_id,station_tel,station_principal
    from exc_station_info
    <where>
      1=1
      <if test="stationID != null">
        and station_id = #{stationID}
      </if>
      <if test="operatorID != null">
        and operator_id = #{operatorID}
      </if>
      <if test="areaCodeList != null and areaCodeList.size()>0 ">
        and area_code in
        <foreach collection="areaCodeList" item="areaCode" index="index" open="(" close=")" separator=",">
          #{areaCode}
        </foreach>
      </if>
    </where>
    ORDER BY sid desc
  </select>-->

  <select id="selectStationDynamicCharge" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="StationHourMap">
    select IFNULL(sum(charge_elec),0) charging_capacity,count(0) charging_num
    from exc_connector_charge_info
    where charge_end_time &gt;=#{startDate} and charge_end_time &lt;=#{endDate}
    <if test="hours!=null">
      and DATE_FORMAT(charge_end_time, '%Y-%m-%d %H')=#{hours}
    </if>
    <if test="operatorID!=null">
      and operator_id=#{operatorID}
    </if>
    <if test="stationID!=null">
      and station_id=#{stationID}
    </if>
  </select>

  <select id="selectCountByIndex" resultType="java.lang.Integer">
    select * from
    (
    select COUNT(0) from exc_operator_info where status_cd=1
    UNION all
    select COUNT(0) from exc_station_info where station_status!=5
    UNION all
    select COUNT(0) from exc_equipment_info where equipment_status not in (5,7)
    UNION all
    select COUNT(0) from exc_connector_info a, exc_equipment_info b
    where a.operator_id=b.operator_id and a.equipment_id=b.equipment_id and b.equipment_status!=5
    ) counts
  </select>

  <select id="getPowerByHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    select ROUND(IFNULL(sum(power.power_sum),0.0),2)
    from
    (
      select ROUND(IFNULL(sum(b.power)/count(b.id),0.0),2) power_sum from
      exc_connector_history_power_info b
      where b.`status`in (3,5) and DATE_FORMAT(b.in_time, '%Y-%m-%d %H')=#{hours}
      GROUP BY b.equipment_id,b.operator_id
    ) power
  </select>

  <select id="getPowerByMinutes" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.Double">
    select ROUND(IFNULL(sum(power.power_sum),0.0),2)
    from
    (
      select ROUND(IFNULL(sum(b.power)/count(b.id),0.0),2) power_sum from
      exc_connector_history_power_info b
      where b.`status`in (3,5) and DATE_FORMAT(b.in_time, '%Y-%m-%d %H:%m')=#{hours}
      GROUP BY b.equipment_id,b.operator_id
    ) power
  </select>

  <select id="getUseRateByHour" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.String">
    SELECT   CONCAT(IFNULL(ROUND(
       (SELECT  sum(charging_duration) as numbers
        from exc_station_statistics_hour
        where insert_time &lt;=#{hours}
		)
     /
		(SELECT sum(timestampdiff(MINUTE,equipmentInfo.equipment_add_time,#{hours})) as numbers
        from  exc_station_info stationInfo LEFT JOIN exc_equipment_info equipmentInfo
        on equipmentInfo.station_id = stationInfo.station_id and equipmentInfo.operator_id = stationInfo.operator_id
      )
    * 100,2),0),'%')
  </select>

  <select id="getUseRateByDay" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultType="java.lang.String">
  select CONCAT(IFNULL(ROUND(
  (
          select IFNULL((ten.cc-twenty.cc),0.0) cc from
      (
              select ${hours} back_time, IFNULL(sum(a.charge_electricity),0.0) cc from
              exc_connector_history_power_info a,exc_station_info b
              where DATE_FORMAT(a.in_time, '%Y-%m-%d') &lt;=#{hours}
              and DATE_FORMAT(a.in_time, '%Y-%m-%d') &gt;= DATE_ADD(#{hours}, INTERVAL 1 DAY)
              and a.station_id=b.station_id and a.operator_id=b.operator_id
              <if test="operatorID!=null">
                and a.operator_id=#{operatorID}
              </if>
              <if test="areaCode!=null">
                and b.area_code=#{areaCode}
              </if>
      ) ten
      LEFT JOIN
      (
              select ${hours} back_time, IFNULL(sum(a.charge_electricity),0.0) cc from
              exc_connector_history_power_info a,exc_station_info b
              where DATE_FORMAT(a.in_time, '%Y-%m-%d') =#{hours}
              and a.station_id=b.station_id and a.operator_id=b.operator_id
              <if test="operatorID!=null">
                and a.operator_id=#{operatorID}
              </if>
              <if test="areaCode!=null">
                and b.area_code=#{areaCode}
              </if>
      ) twenty on ten.back_time=twenty.back_time
  )
  /
  (
      select  IFNULL(sum(equipment.equipment_power),0.0)*24 cc from
          (
              select  equipment_id,operator_id  from
              exc_connector_history_power_info
              where DATE_FORMAT(in_time, '%Y-%m-%d') =#{hours}
              GROUP BY connector_id,operator_id
          ) pow
      INNER JOIN exc_equipment_info equipment on pow.equipment_id=equipment.equipment_id
      and pow.operator_id=equipment.operator_id
      INNER JOIN exc_station_info b on equipment.station_id=b.station_id and equipment.operator_id=b.operator_id
      <if test="operatorID!=null">
        and b.operator_id=#{operatorID}
      </if>
      <if test="areaCode!=null">
        and b.area_code=#{areaCode}
      </if>
  )
  * 100,2),0),'%')
  </select>


  <select id="getUseRateThirtyMinute" resultMap="BaseResultMap">
    select time.back_time build_date,CONCAT(IFNULL(ROUND(IFNULL(charge_elec.cc,0.0)/IFNULL(equipment_power.cc,0.0)* 100,2),0),'%') charge_electic_sum
    from
    (
      select DATE_FORMAT(in_time,'%Y-%m-%d %H:%i:00') back_time
      FROM exc_connector_history_power_info
      WHERE in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 30 MINUTE
      group by back_time
    ) time
    LEFT JOIN
    (
      select ten.back_time, (ten.cc-twenty.cc) cc from
      (
        select aa.back_time, IFNULL(sum(bb.charge_electricity),0.0) cc from
        (
        select in_time, DATE_FORMAT(in_time,'%Y-%m-%d %H:%i:00') back_time,
        DATE_FORMAT(date_add(in_time, interval -10 minute),'%Y-%m-%d %H:%i:00') front2_time
        FROM exc_connector_history_power_info
        WHERE in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 30 MINUTE
        group by back_time
        ) aa  , exc_connector_history_power_info bb
        where bb.in_time between aa.front2_time and aa.back_time
        GROUP BY aa.back_time
      ) ten
      LEFT JOIN
      (
        select aa.back_time, IFNULL(sum(bb.charge_electricity),0.0) cc from
        (
        select in_time, DATE_FORMAT(in_time,'%Y-%m-%d %H:%i:00') back_time,
        DATE_FORMAT(date_add(in_time, interval -10 minute),'%Y-%m-%d %H:%i:00') front2_time,
        DATE_FORMAT(date_add(in_time, interval -20 minute),'%Y-%m-%d %H:%i:00') front1_time
        FROM exc_connector_history_power_info
        WHERE in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 30 MINUTE
        group by back_time
        ) aa  , exc_connector_history_power_info bb
        where bb.in_time between aa.front1_time and aa.front2_time
        GROUP BY aa.back_time
      ) twenty on ten.back_time=twenty.back_time

    ) charge_elec   on time.back_time=charge_elec.back_time
    LEFT JOIN
    (
      select pow.back_time,  IFNULL(sum(equipment.equipment_power),0.0)*1.667 cc from
      (
        select aa.back_time,  bb.equipment_id,bb.operator_id  from
        (
          select in_time, DATE_FORMAT(in_time,'%Y-%m-%d %H:%i:00') back_time,
          DATE_FORMAT(date_add(in_time, interval -10 minute),'%Y-%m-%d %H:%i:00') front_time
          FROM exc_connector_history_power_info
          WHERE in_time &gt;=CURRENT_TIMESTAMP - INTERVAL 30 MINUTE
          group by back_time
        ) aa  , exc_connector_history_power_info bb
        where bb.in_time&gt;=aa.front_time and bb.in_time&lt;=aa.back_time
        GROUP BY aa.back_time,bb.connector_id,bb.operator_id
      ) pow
      INNER JOIN exc_equipment_info equipment on pow.equipment_id=equipment.equipment_id
      and pow.operator_id=equipment.operator_id
      GROUP BY pow.back_time
    ) equipment_power on time.back_time=equipment_power.back_time

  </select>

  <select id="getChargePowerByFifteen" resultMap="BaseResultMap">
    select DATE_FORMAT(CONCAT(CURDATE(),' ',quarterTime.quarter_time),'%Y-%m-%d %H:%i:%s') build_date,
    sum(IFNULL(a.power_sum,0.0)) power_sum from
    quarter_time quarterTime LEFT JOIN
    (
      select a.back_time ,ROUND(IFNULL(sum(b.power)/count(b.id),0.0),2) power_sum from
      (select DATE_FORMAT(CONCAT(CURDATE(),' ',quarter_time),'%Y-%m-%d %H:%i:%s') back_time,
      date_sub(DATE_FORMAT(CONCAT(CURDATE(),' ',quarter_time),'%Y-%m-%d %H:%i:%s'),interval 15 minute) front_time
      from quarter_time
      where DATE_FORMAT(CONCAT(CURDATE(),' ',quarter_time),'%Y-%m-%d %H:%i:%s') &lt;=NOW()
      )a , exc_connector_history_power_info b
      where b.`status`in (3,5) and b.in_time&lt;=a.back_time and b.in_time&gt;=a.front_time
      GROUP BY b.equipment_id,b.operator_id
    ) a on a.back_time= DATE_FORMAT(CONCAT(CURDATE(),' ',quarterTime.quarter_time),'%Y-%m-%d %H:%i:%s')
    where DATE_FORMAT(CONCAT(CURDATE(),' ',quarterTime.quarter_time),'%Y-%m-%d %H:%i:%s') &lt;=NOW()
    GROUP BY DATE_FORMAT(CONCAT(CURDATE(),' ',quarterTime.quarter_time),'%Y-%m-%d %H:%i:%s')
  </select>

  <select id="getChargeSumByFifteen" resultMap="BaseResultMap">
    select a.back_time build_date,ROUND(IFNULL(sum(b.charge_electricity),0.0),2) power_sum from
    (select DATE_FORMAT(CONCAT(CURDATE(),' ',quarter_time),'%Y-%m-%d %H:%i:%s') back_time
    from quarter_time where DATE_FORMAT(CONCAT(CURDATE(),' ',quarter_time),'%Y-%m-%d %H:%i:%s') &lt;=NOW()
    ) a,exc_connector_history_power_info b
    where b.in_time&lt;=a.back_time and b.in_time&gt;=DATE_FORMAT(CONCAT(CURDATE()),'%Y-%m-%d %H:%i:%s')
    GROUP BY a.back_time
  </select>
</mapper>