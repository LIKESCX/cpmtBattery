<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cpit.cpmt.biz.dao.analyze.preprocess.StationStatisticsDayDao" >
  <resultMap id="BaseResultMap" type="com.cpit.cpmt.dto.analyze.preprocess.StationStatisticsDay" >
    <result column="operator_id" property="operatorId" jdbcType="VARCHAR" />
    <result column="station_id" property="stationId" jdbcType="VARCHAR" />
    <result column="insert_time" property="insertTime" jdbcType="TIMESTAMP" />
    <result column="charging_capacity" property="chargingCapacity" jdbcType="DOUBLE" />
    <result column="charging_duration" property="chargingDuration" jdbcType="DOUBLE" />
    <result column="online_duration" property="onlineDuration" jdbcType="DOUBLE" />
    <result column="pole_num" property="poleNum" jdbcType="INTEGER" />
    <result column="charging_num" property="chargingNum" jdbcType="INTEGER" />
  </resultMap>
    <select id="selectAll" resultMap="BaseResultMap">
    select * from exc_station_statistics_day
    
    </select>
    
    <insert id="stationStatisticTask">
    	insert into exc_station_statistics_day(operator_id,station_id,online_duration,insert_time,pole_num) select operator_id,station_id,sum(online_duration) as online_duration,insert_time,pole_num from exc_station_statistics_hour where insert_time&gt;=DATE_SUB(CURDATE(),INTERVAL 1 Day) and insert_time&lt;CURDATE() GROUP by operator_id ,station_id

    </insert>
    
    <select id="selectByPrimary" resultMap="BaseResultMap">
    	select * from exc_station_statistics_day where operator_id=#{operatorId} and station_id=#{stationId} and insert_time=#{insertTime}
    </select>
    
    <insert id="insertByPrimary">
    insert into exc_station_statistics_day(
	operator_id,
	station_id,
	insert_time,
	charging_capacity,
	charging_duration,
	online_duration,
	pole_num,
	charging_num,
	direct_charging_duration,
	communication_charging_duration,
	mix_charging_duration,
	wireless_charging_duration,
	charge_discharge_charging_duration,
	other_charging_duration
	) values(#{operatorId},#{stationId},#{insertTime},#{chargingCapacity},#{chargingDuration},0,#{poleNum},#{chargingNum},0.0,0.0,0.0,0.0,0.0,0.0)
    </insert>
    
    <update id="updateByPrimary">
    	UPDATE exc_station_statistics_day
		SET charging_capacity = charging_capacity + #{chargingCapacity},
		 charging_duration = charging_duration + #{chargingDuration},
		 charging_num = charging_num + #{chargingNum}
		WHERE
			operator_id=#{operatorId}
		And station_id=#{stationId}
		And insert_time=#{insertTime}
    </update>
    
    <insert id="insertByPrimaryForOnlineDuration">
    insert into exc_station_statistics_day(
	operator_id,
	station_id,
	insert_time,
	charging_capacity,
	charging_duration,
	online_duration,
	charging_num,
	pole_num
	) values(#{operatorId},#{stationId},#{insertTime},0.0,0.0,#{onlineDuration},0,#{poleNum})
    </insert>
    
    
    <update id="updateByPrimaryForOnlineDuration">
    	UPDATE exc_station_statistics_day
		SET online_duration=online_duration+#{onlineDuration}
		WHERE
			operator_id=#{operatorId}
		And station_id=#{stationId}
		And insert_time=#{insertTime}
    </update>
   
 
 
    <update id="updateTypeChargingDay">
    	UPDATE exc_station_statistics_day
		SET pole_num = pole_num
		<if test="type==1">
			,direct_charging_duration=direct_charging_duration+#{duration}
		</if>
		<if test="type==2">
			,communication_charging_duration=communication_charging_duration+#{duration}
		</if>
		<if test="type==3">
			,mix_charging_duration=mix_charging_duration+#{duration}
		</if>
		<if test="type==4">
			,wireless_charging_duration=wireless_charging_duration+#{duration}
		</if>
		<if test="type==5">
			,charge_discharge_charging_duration=charge_discharge_charging_duration+#{duration}
		</if>
		<if test="type==6">
			,other_charging_duration=other_charging_duration+#{duration}
		</if>
		where operator_id=#{operatorId} and station_id=#{stationId} and insert_time=#{insertTime}
    
    </update>

	<select id="selectBigScreenMonthInfo" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
		select IFNULL(sum(charging_capacity),0) charging_capacity,IFNULL(sum(charging_duration),0) charging_duration,
		IFNULL(sum(charging_num),0) charging_num
		from exc_station_statistics_day
		where 1=1
		<if test="hours!=null">
			and DATE_FORMAT(insert_time, '%Y-%m')=#{hours}
		</if>
	</select>

	<select id="selectBigScreenDayInfo" parameterType="com.cpit.cpmt.dto.exchange.operator.StationInfoShow" resultMap="BaseResultMap">
		select IFNULL(sum(a.charging_capacity),0) charging_capacity,IFNULL(sum(a.charging_num),0) charging_num
		from exc_station_statistics_day a, exc_station_info b
		where a.station_id=b.station_id and a.operator_id=b.operator_id
		<if test="hours!=null">
			and DATE_FORMAT(a.insert_time, '%y-%m-%d')=#{hours}
		</if>
		<if test="operatorID!=null">
			and a.operator_id=#{operatorID}
		</if>
		<if test="areaCode!=null">
			and b.area_code=#{areaCode}
		</if>
	</select>
</mapper>