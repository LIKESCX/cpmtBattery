<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cpit.cpmt.biz.dao.security.RiskControlDao" >
  <resultMap id="BaseResultMap" type="com.cpit.cpmt.dto.security.RiskControl" >
    <id column="risk_id" property="riskId" jdbcType="INTEGER" />
    <result column="operator_id" property="operatorId" jdbcType="VARCHAR" />
    <result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
    <result column="station_id" property="stationId" jdbcType="VARCHAR" />
    <result column="station_name" property="stationName" jdbcType="VARCHAR" />
    <result column="equipment_id" property="equipmentId" jdbcType="VARCHAR" />
    <result column="equipment_name" property="equipmentName" jdbcType="VARCHAR" />
    <result column="cid" property="cid" jdbcType="VARCHAR" />
    <result column="eid" property="eid" jdbcType="VARCHAR"/>
    <result column="connector_Name" property="connectorName" jdbcType="VARCHAR" />
    <result column="area_code" property="areaCode" jdbcType="VARCHAR" />
    <result column="alarm_level" property="alarmLevel" jdbcType="INTEGER" />
    <result column="alarm_code" property="alarmCode" jdbcType="VARCHAR" />
    <result column="alarm_type" property="alarmType" jdbcType="INTEGER" />
    <result column="alarm_desc" property="alarmDesc" jdbcType="VARCHAR" />
    <result column="alarm_time" property="alarmTime" jdbcType="TIMESTAMP" />
    <result column="alarm_status" property="alarmStatus" jdbcType="INTEGER" />
    <result column="deal_result" property="dealResult" jdbcType="INTEGER" />
    <result column="deal_step" property="dealStep" jdbcType="VARCHAR" />
    <result column="deal_time" property="dealTime" jdbcType="TIMESTAMP" />
    <result column="deal_person" property="dealPerson" jdbcType="VARCHAR" />
    <result column="affirm" property="affirm" jdbcType="INTEGER" />
    <result column="affirm_time" property="affirmTime" jdbcType="TIMESTAMP" />
    <result column="affirm_person" property="affirmPerson" jdbcType="VARCHAR" />
    <result column="in_time" property="inTime" jdbcType="TIMESTAMP" />
    <result column="cid" property="cid" jdbcType="VARCHAR" />
  </resultMap>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select a.id as risk_id,a.operator_id,b.operator_name,a.station_id,a.station_name,a.eid,eei.equipment_name,a.cid,eci.connector_name,a.area_code,a.alarm_level,a.alarm_code,a.alarm_type,a.alarm_desc,a.equipment_id,
    a.alarm_time,a.alarm_status,a.deal_result,a.deal_time,a.deal_person,a.affirm,a.affirm_time,affirm_person,a.in_time
    from exc_alarm_info a
    left join exc_operator_info b on a.operator_id = b.operator_id
    left join exc_equipment_info eei on a.eid = eei.eid
    left join exc_connector_info eci on a.cid = eci.cid
    where id = #{riskId,jdbcType=INTEGER}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from exc_alarm_info
    where id = #{riskId,jdbcType=INTEGER}
  </delete>

<!--  未使用-->
  <insert id="insertSelective" parameterType="com.cpit.cpmt.dto.security.RiskControl" >
    insert into exc_alarm_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
        in_time,
      <if test="riskId != null" >
        risk_id,
      </if>
      <if test="operatorId != null" >
        operator_id,
      </if>
      <if test="operatorName != null" >
        operator_name,
      </if>
      <if test="stationId != null" >
        station_id,
      </if>
      <if test="stationName != null" >
        station_name,
      </if>
      <if test="equipmentId != null" >
        equipment_id,
      </if>
      <if test="equipmentName != null" >
        equipment_name,
      </if>
      <if test="cid != null" >
        equipment_face_id,
      </if>
      <if test="connectorName != null" >
        equipment_face_name,
      </if>
      <if test="areaCode != null" >
        area_code,
      </if>
      <if test="alarmLevel != null" >
        alarm_level,
      </if>
      <if test="alarmCode != null" >
        alarm_code,
      </if>
      <if test="alarmType != null" >
        alarm_type,
      </if>
      <if test="alarmDesc != null" >
        alarm_desc,
      </if>
      <if test="alarmTime != null" >
        alarm_time,
      </if>
      <if test="alarmStatus != null" >
        alarm_status,
      </if>
      <if test="dealResult != null" >
        deal_result,
      </if>
      <if test="dealStep != null" >
        deal_step,
      </if>
      <if test="dealTime != null" >
        deal_time,
      </if>
      <if test="dealPerson != null" >
        deal_person,
      </if>
      <if test="affirm != null" >
        affirm,
      </if>
      <if test="affirmTime != null" >
        affirm_time,
      </if>
      <if test="affirmPerson != null" >
        affirm_person,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
        NOW(),
      <if test="riskId != null" >
        #{riskId,jdbcType=INTEGER},
      </if>
      <if test="operatorId != null" >
        #{operatorId,jdbcType=VARCHAR},
      </if>
      <if test="operatorName != null" >
        #{operatorName,jdbcType=VARCHAR},
      </if>
      <if test="stationId != null" >
        #{stationId,jdbcType=VARCHAR},
      </if>
      <if test="stationName != null" >
        #{stationName,jdbcType=VARCHAR},
      </if>
      <if test="equipmentId != null" >
        #{equipmentId,jdbcType=VARCHAR},
      </if>
      <if test="equipmentName != null" >
        #{equipmentName,jdbcType=VARCHAR},
      </if>
      <if test="cid != null" >
        #{cid,jdbcType=VARCHAR},
      </if>
      <if test="connectorName != null" >
        #{connectorName,jdbcType=VARCHAR},
      </if>
      <if test="areaCode != null" >
        #{areaCode,jdbcType=VARCHAR},
      </if>
      <if test="alarmLevel != null" >
        #{alarmLevel,jdbcType=INTEGER},
      </if>
      <if test="alarmCode != null" >
        #{alarmCode,jdbcType=VARCHAR},
      </if>
      <if test="alarmType != null" >
        #{alarmType,jdbcType=INTEGER},
      </if>
      <if test="alarmDesc != null" >
        #{alarmDesc,jdbcType=VARCHAR},
      </if>
      <if test="alarmTime != null" >
        #{alarmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="alarmStatus != null" >
        #{alarmStatus,jdbcType=INTEGER},
      </if>
      <if test="dealResult != null" >
        #{dealResult,jdbcType=INTEGER},
      </if>
      <if test="dealStep != null" >
        #{dealStep,jdbcType=VARCHAR},
      </if>
      <if test="dealTime != null" >
        #{dealTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dealPerson != null" >
        #{dealPerson,jdbcType=VARCHAR},
      </if>
      <if test="affirm != null" >
        #{affirm,jdbcType=INTEGER},
      </if>
      <if test="affirmTime != null" >
        #{affirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="affirmPerson != null" >
        #{affirmPerson,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="com.cpit.cpmt.dto.security.RiskControl" >
    update exc_alarm_info
    <set >
      <if test="operatorId != null" >
        operator_id = #{operatorId,jdbcType=VARCHAR},
      </if>
      <if test="operatorName != null" >
        operator_name = #{operatorName,jdbcType=VARCHAR},
      </if>
      <if test="stationId != null" >
        station_id = #{stationId,jdbcType=VARCHAR},
      </if>
      <if test="stationName != null" >
        station_name = #{stationName,jdbcType=VARCHAR},
      </if>
      <if test="equipmentId != null" >
        equipment_id = #{equipmentId,jdbcType=VARCHAR},
      </if>
      <if test="equipmentName != null" >
        equipment_name = #{equipmentName,jdbcType=VARCHAR},
      </if>
      <if test="cid != null" >
        equipment_face_id = #{cid,jdbcType=VARCHAR},
      </if>
      <if test="connectorName != null" >
        equipment_face_name = #{connectorName,jdbcType=VARCHAR},
      </if>
      <if test="areaCode != null" >
        area_code = #{areaCode,jdbcType=VARCHAR},
      </if>
      <if test="alarmLevel != null" >
        alarm_level = #{alarmLevel,jdbcType=INTEGER},
      </if>
      <if test="alarmCode != null" >
        alarm_code = #{alarmCode,jdbcType=VARCHAR},
      </if>
      <if test="alarmType != null" >
        alarm_type = #{alarmType,jdbcType=INTEGER},
      </if>
      <if test="alarmDesc != null" >
        alarm_desc = #{alarmDesc,jdbcType=VARCHAR},
      </if>
      <if test="alarmTime != null" >
        alarm_time = #{alarmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="alarmStatus != null" >
        alarm_status = #{alarmStatus,jdbcType=INTEGER},
      </if>
      <if test="dealResult != null" >
        deal_result = #{dealResult,jdbcType=INTEGER},
      </if>
      <if test="dealStep != null" >
        deal_step = #{dealStep,jdbcType=VARCHAR},
      </if>
      <if test="dealTime != null" >
        deal_time = #{dealTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dealPerson != null" >
        deal_person = #{dealPerson,jdbcType=VARCHAR},
      </if>
      <if test="affirm != null" >
        affirm = #{affirm,jdbcType=INTEGER},
      </if>
      <if test="affirmTime != null" >
        affirm_time = #{affirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="affirmPerson != null" >
        affirm_person = #{affirmPerson,jdbcType=VARCHAR},
      </if>
      <if test="inTime != null" >
        in_time = #{inTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{riskId,jdbcType=INTEGER}
  </update>

  
  <select id="getRiskControlList" resultMap="BaseResultMap" parameterType="com.cpit.cpmt.dto.security.RiskControl">
    select a.id as risk_id,a.operator_id,b.operator_name,a.station_id,a.station_name,a.eid,eei.equipment_name,a.cid,eci.connector_name,a.area_code,a.alarm_level,a.alarm_code,a.alarm_type,a.alarm_desc,a.equipment_id,
    a.alarm_time,a.alarm_status,a.deal_result,a.deal_time,a.deal_person,a.affirm,a.affirm_time,affirm_person,a.in_time
    from exc_alarm_info a
    left join exc_operator_info b on a.operator_id = b.operator_id
    left join exc_equipment_info eei on a.eid = eei.eid
    left join exc_connector_info eci on a.cid = eci.cid
  where 1=1
    <if test="stationStreet!=null and !stationStreet.trim.empty and areaCode!=null  and !areaCode.trim.empty">
      and a.station_id in (select  station_id from exc_station_info where exc_station_info.area_code=#{areaCode,jdbcType=VARCHAR} and exc_station_info.station_street=#{stationStreet,jdbcType=VARCHAR})
    </if>
    <if test="operatorId != null and operatorId != ''">
		and a.operator_id = #{operatorId,jdbcType=VARCHAR}
	</if>
	<if test="stationId != null and stationId != ''">
		and a.station_id = #{stationId,jdbcType=VARCHAR}
	</if>
	<if test="equipmentId != null and equipmentId != ''">
		and a.equipment_id = #{equipmentId,jdbcType=VARCHAR}
	</if>
	<if test="alarmLevel != null and alarmLevel != ''">
		and a.alarm_level = #{alarmLevel,jdbcType=INTEGER}
	</if>
	<if test="dealResult != null">
		and a.deal_result = #{dealResult,jdbcType=INTEGER}
	</if>
	<if test="affirm != null">
		and a.affirm = #{affirm,jdbcType=INTEGER}
	</if>
	<if test="startTime != null">
        and a.alarm_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP}
    </if>
    <if test="areaList != null and areaList.size()>0"> 
		and a.area_code in
		<foreach collection="areaList" item="area" index="index" open="(" close=")" separator=",">
			#{area.areaCode}
		</foreach>
	</if>
    order by a.alarm_time desc
  </select>
  
  <select id="getCountByLevel" resultMap="BaseResultMap">
    select alarm_level,count(id) as account from exc_alarm_info where alarm_level in (1,2,3) GROUP BY alarm_level
  </select>
  
  <select id="getCountByType" resultMap="BaseResultMap">
    select alarm_type,count(id) as account from exc_alarm_info where alarm_type in (1,2,3) GROUP BY alarm_type
  </select>

  <select id="getCountByRiskControl" parameterType="com.cpit.cpmt.dto.security.RiskControl" resultType="integer">
    select  count(1) from   exc_alarm_info  a
    <trim prefix="where" prefixOverrides="and" >
      <if test="stationStreet!=null and !stationStreet.trim.empty and areaCode!=null  and !areaCode.trim.empty">
        and a.station_id in (select  station_id from exc_station_info where exc_station_info.area_code=#{areaCode,jdbcType=VARCHAR} and exc_station_info.station_street=#{stationStreet,jdbcType=VARCHAR})
      </if>
      <if test="operatorId != null and operatorId != ''">
        and a.operator_id = #{operatorId,jdbcType=VARCHAR}
      </if>
      <if test="stationId != null and stationId != ''">
        and a.station_id = #{stationId,jdbcType=VARCHAR}
      </if>
      <if test="equipmentId != null and equipmentId != ''">
        and a.equipment_id = #{equipmentId,jdbcType=VARCHAR}
      </if>
      <if test="alarmLevel != null and alarmLevel != ''">
        and a.alarm_level = #{alarmLevel,jdbcType=INTEGER}
      </if>
      <if test="dealResult != null">
        and a.deal_result = #{dealResult,jdbcType=INTEGER}
      </if>
      <if test="affirm != null">
        and a.affirm = #{affirm,jdbcType=INTEGER}
      </if>
      <if test="startTime != null">
        and a.alarm_time BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP}
      </if>
      <if test="areaList != null and areaList.size()>0">
        and a.area_code in
        <foreach collection="areaList" item="area" index="index" open="(" close=")" separator=",">
          #{area.areaCode}
        </foreach>
      </if>
    </trim>

  </select>
  
</mapper>